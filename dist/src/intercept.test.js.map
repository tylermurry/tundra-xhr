{"version":3,"sources":["../../src/intercept.test.js"],"names":["makeFakeRequest","Promise","resolve","xhr","XMLHttpRequest","open","onload","send","jest","mock","fn","describe","it","callback","undefined","calls","response","headers","submitRequestData","expect","toMatchSnapshot"],"mappings":";;AAAA;;;;AACA;;;;;;;;AAEA,SAASA,eAAT,GAA2B;AACzB;AACA;AACA;;AAEA,SAAO,IAAIC,OAAJ,CAAa,UAACC,OAAD,EAAa;AAC/B,QAAMC,MAAM,IAAIC,cAAJ,EAAZ,CAD+B,CACG;;AAElCD,QAAIE,IAAJ,CAAS,KAAT,EAAgB,wBAAhB;AACAF,QAAIG,MAAJ,GAAaJ,OAAb;AACAC,QAAII,IAAJ;AACD,GANM,CAAP;AAOD;;AAEDC,KAAKC,IAAL,CAAU,iBAAV,EAA6B;AAAA,SAAMD,KAAKE,EAAL,EAAN;AAAA,CAA7B;;AAEAC,SAAS,WAAT,EAAsB,YAAM;AAC1BC,KAAG,mCAAH,0DAAwC;AAAA;AAAA;AAAA;AAAA;AAAA;AAChCC,oBADgC,GACrBL,KAAKE,EAAL,EADqB;;;AAGtC,qCAAeI,SAAf,EAA0BD,QAA1B;;AAHsC;AAAA,mBAKhCb,iBALgC;;AAAA;;AAOtC;AACAa,qBAASJ,IAAT,CAAcM,KAAd,CAAoB,CAApB,EAAuB,CAAvB,EAA0BC,QAA1B,CAAmCC,OAAnC,CAA2C,MAA3C,IAAqD,aAArD;AACAC,oCAAkBT,IAAlB,CAAuBM,KAAvB,CAA6B,CAA7B,EAAgC,CAAhC,EAAmCC,QAAnC,CAA4CC,OAA5C,CAAoD,MAApD,IAA8D,aAA9D;;AAEAE,mBAAON,SAASJ,IAAT,CAAcM,KAArB,EAA4BK,eAA5B;AACAD,mBAAOD,wBAAkBT,IAAlB,CAAuBM,KAA9B,EAAqCK,eAArC;;AAZsC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAxC;AAcD,CAfD","file":"intercept.test.js","sourcesContent":["import interceptCalls from './intercept';\nimport submitRequestData from './submitRequest';\n\nfunction makeFakeRequest() {\n  // It's not possible to both mock XHR and make a 'fake' real request.\n  // Instead, we're calling out to a real URL that will likely always be\n  // there and unlikely to change. #tradeoffs\n\n  return new Promise(((resolve) => {\n    const xhr = new XMLHttpRequest(); // eslint-disable-line no-undef\n\n    xhr.open('GET', 'http://httpstat.us/200');\n    xhr.onload = resolve;\n    xhr.send();\n  }));\n}\n\njest.mock('./submitRequest', () => jest.fn());\n\ndescribe('intercept', () => {\n  it('should proxy the request properly', async () => {\n    const callback = jest.fn();\n\n    interceptCalls(undefined, callback);\n\n    await makeFakeRequest();\n\n    // Dear future self, please forgive this mortal sin. Fix when able.\n    callback.mock.calls[0][0].response.headers['date'] = 'static date';\n    submitRequestData.mock.calls[0][0].response.headers['date'] = 'static date';\n\n    expect(callback.mock.calls).toMatchSnapshot();\n    expect(submitRequestData.mock.calls).toMatchSnapshot();\n  });\n});\n"]}